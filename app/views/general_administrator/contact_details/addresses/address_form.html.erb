<section class='small-10 columns'>
  <div class='mainheader'> Address </div>
  <div class='subdescription'> Add a address entry to the system </div>
  <hr>
  <div class='small-9 columns generic_form'>

    <% if @selected_address[:id].present? %>
        <span class="current_edit_id">
          <%= 'Editing Address ID: ' + @selected_address[:id].to_s %>
        </span>
        <br><br>
    <% end %>

    <%
       @selected_address[:id].present? ?
               (current_method = :patch; current_action = @selected_address[:id] ) :
               (current_method = :post; current_action = 'create')
    %>

    <%=
        form_tag( {:action => current_action},
                  {:method => current_method,
                   class: 'create_form',
                   id: "new_address_form",
                   :"data-parsley-validate" => "" },
        ) do
    %>

        <%= hidden_field_tag('address[id]', @selected_address[:id] ) %>

        <div class="form-block">
          <section class="form-block-label">Model</section>
          <section class="form-block-control">
            <select name='address[rel_model_type]'
                    style="width: 50%"
                    required="required" >
              <% if @selected_address[:rel_model_type] == 'Actor' %>
                  <option value="Actor" selected>Actor</option>
                  <option value="Branch">Branch</option>
              <% elsif @selected_address[:rel_model_type] == 'Branch' %>
                  <option value="Actor">Actor</option>
                  <option value="Branch" selected>Branch</option>
              <% else %>
                  <option disabled selected>Select Model</option>
                  <option value="Actor">Actor</option>
                  <option value="Branch">Branch</option>
              <% end %>
            </select>
          </section>
        </div>

        <div class="form-block">
          <section class="form-block-label">Actor</section>
          <section class="form-block-control">
            <select name='address[rel_model_id]'
                    id='new_address_rel_model_id'
                    class='employee_select_field'
                    required="required" >

              <option value="" disabled selected>Select Actor</option>
              <% @actors.each do |actor| %>
                  <% if actor.id == @selected_address[:rel_model_id] %>
                      <option value=<%= actor.id %> selected><%= actor.name %></option>
                  <% else %>
                      <option value=<%= actor.id %>><%= actor.name %></option>
                  <% end %>
              <% end %>
            </select>
          </section>
        </div>

        <div class="large-12 columns">
          <h2 class="miniheader">Addresses</h2>
          <p id="map_special_instructions">
          <div class="subdescription">
            DRAG RED MARKER; DOUBLE LEFT CLICK TO ZOOM OUT, DOUBLE RIGHT CLICK TO ZOOM IN. SCROLL TO ZOOM. HOLD LEFT MOUSE BUTTON TO PAN.
          </div>
          </p>
          <div class="mapcontainer">
            <div class="mapset" id="primary" align="center">
              <hr>
              <div class="map" style="width: 800px; height: 300px;"></div><br>
              <textarea name="address[description]" placeholder="Type Address Here" class="map-address" data-parsley-trigger="keyup" data-parsley-maxlength="256"></textarea>
              <div class="large-1 columns"> <%= t('access.latitude') %>: </div>
              <div class="large-11 columns">
                <input type="text" class="map-lat" name="address[latitude]" id="latitude" data-parsley-type="number"/>
              </div>
              <div class="large-1 columns"><%= t('access.longitude') %>: </div>
              <div class="large-11 columns">
                <input type="text" class="map-lon" name="address[longitude]" id="longitude" data-parsley-type="number"/>
              </div>
            </div>
          </div>

          <hr />

          <script type="text/javascript" src='http://maps.google.com/maps/api/js?sensor=false&libraries=places'></script>
          <script>

              $( document ).ready(function() {
                  navigator.geolocation.getCurrentPosition(showPosition);
                  function showPosition(position) {
                      var lat = position.coords.latitude;
                      var lng = position.coords.longitude;
                      $('.map-lat').val(lat);
                      $('.map-lon').val(lng);
                      buildMap(lat, lng);
                  }
                  buildMap(lat, lng);
              });

              function buildMap(lat, lng) {
                  $('.map').locationpicker({
                      location: {
                          latitude: +lat || 14.621801,
                          longitude: +lng || 121.106436
                      },
                      radius: 10,
                      inputBinding: {
                          latitudeInput: $('.map-lat'),
                          longitudeInput: $('.map-lon'),
                          radiusInput: $('.map-radius'),
                          locationNameInput: $('.map-address'),
                          scrollwheel: true
                      },
                      enableReverseGeocode: true
                  });
              }
          </script>
        </div>

        <%= generic_form_footer(@selected_address[:id]) %>

    <% end %>

  </div>
</section>