

<div class="form-block">
  <div class="label">Model</div>
  <br />
  <select id="model-dropdown" name='address[rel_model_type]'
          required="required" >
    <% if @selected_address[:rel_model_type] == 'Actor' %>
        <option value="Actor" selected>Actor</option>
        <option value="Branch">Branch</option>
    <% elsif @selected_address[:rel_model_type] == 'Branch' %>
        <option value="Actor">Actor</option>
        <option value="Branch" selected>Branch</option>
    <% else %>
        <option disabled selected>Select Model</option>
        <option value="Actor">Actor</option>
        <option value="Branch">Branch</option>
    <% end %>
  </select>
</div>

<div id="actor-selector" class="form-block">
  <div class="label">Actor</div>
  <br />
  <select name='address[rel_model_id]'
          id='new_address_rel_model_id'
          class='employee_select_field selectized'>

    <option value="" disabled selected>Select Actor</option>
    <% @actors.each do |actor| %>
        <% if actor.id == @selected_address[:rel_model_id] %>
            <option value=<%= actor.id %> selected><%= actor.name %></option>
        <% else %>
            <option value=<%= actor.id %>><%= actor.name %></option>
        <% end %>
    <% end %>
  </select>
</div>

<div id="branch-selector" class="form-block">
  <div class="label">Branch</div>
  <br />
  <select name='address[rel_model_id]'
          id='new_address_rel_model_id2'
          class='employee_select_field selectized'>

    <option value="" disabled selected>Select Branch</option>
    <% @branches.each do |branch| %>
        <% if branch.id == @selected_address[:rel_model_id] %>
            <option value=<%= branch.id %> selected><%= branch.name %></option>
        <% else %>
            <option value=<%= branch.id %>><%= branch.name %></option>
        <% end %>
    <% end %>
  </select>
</div>


<div class="large-12 columns">
  <h2 class="miniheader">Addresses</h2>
  <p id="map_special_instructions">
  <div class="subdescription">
    DRAG RED MARKER; DOUBLE LEFT CLICK TO ZOOM OUT, DOUBLE RIGHT CLICK TO ZOOM IN. SCROLL TO ZOOM. HOLD LEFT MOUSE BUTTON TO PAN.
  </div>
  </p>
  <div class="mapcontainer">
    <div class="mapset" id="primary" align="center">
      <hr>
      <div class="map" style="width: 800px; height: 300px;"></div><br>
      <textarea name="address[description]" placeholder="Type Address Here" class="map-address" data-parsley-trigger="keyup" data-parsley-maxlength="256"></textarea>
      <div class="large-1 columns"> <%= t('access.latitude') %>: </div>
      <div class="large-11 columns">
        <input type="text" class="map-lat" name="address[latitude]" id="latitude" data-parsley-type="number"/>
      </div>
      <div class="large-1 columns"><%= t('access.longitude') %>: </div>
      <div class="large-11 columns">
        <input type="text" class="map-lon" name="address[longitude]" id="longitude" data-parsley-type="number"/>
      </div>
    </div>
  </div>

  <hr />

  <script type="text/javascript" src='http://maps.google.com/maps/api/js?sensor=false&libraries=places'></script>
  <script>

      // selectize
      $(document).ready(function(){
          $('#new_address_rel_model_id').selectize({
              sortField: 'text'
          })
          ;

          $('#new_address_rel_model_id1').selectize({sortField: 'text'});
          $('#new_address_rel_model_id2').selectize({sortField: 'text'});
          $("#branch-selector select[name*='address[rel_model_id]']").prop('disabled', true);
          $("#actor-selector").hide();
          $("#branch-selector").hide();

      });

      $("#model-dropdown").change(function(){
          if($("#model-dropdown").val() == "Actor"){
              $("#actor-selector").show();
              $("#branch-selector select[name*='address[rel_model_id]']").prop('disabled', true);
              $("#actor-selector select[name*='address[rel_model_id]']").removeAttr('disabled');
              $("#branch-selector").hide();
          } else if($("#model-dropdown").val() == "Branch"){
              $("#branch-selector").show();
              $("#actor-selector select[name*='address[rel_model_id]']").prop('disabled', true);
              $("#branch-selector select[name*='address[rel_model_id]']").removeAttr('disabled');
              $("#actor-selector").hide();
          }
      });

      $( document ).ready(function() {
          navigator.geolocation.getCurrentPosition(showPosition);
          function showPosition(position) {
              var lat = position.coords.latitude;
              var lng = position.coords.longitude;
              $('.map-lat').val(lat);
              $('.map-lon').val(lng);
              buildMap(lat, lng);
          }
          buildMap(lat, lng);
      });

      function buildMap(lat, lng) {
          $('.map').locationpicker({
              location: {
                  latitude: +lat || 14.621801,
                  longitude: +lng || 121.106436
              },
              radius: 10,
              inputBinding: {
                  latitudeInput: $('.map-lat'),
                  longitudeInput: $('.map-lon'),
                  radiusInput: $('.map-radius'),
                  locationNameInput: $('.map-address'),
                  scrollwheel: true
              },
              enableReverseGeocode: true
          });
      }
  </script>
</div>
